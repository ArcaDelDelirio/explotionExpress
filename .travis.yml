branches:
  only:
    - master
    - docs

services:
  - docker

matrix:
  include:
    - language: bash  
      name: "Docker Build"    
      before_script: docker build -t express-mongo .
      script: docker run -d -p 27017:27017 express-mongo
      after_success: 
        - docker ps  
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        - docker push $DOCKER_USERNAME/express-mongo


    - language: node_js
      name : "Documentation Deployment"
      nodejs:
        - "10"
      script: 
        - npm run build
        - npm run build:docs
      deploy:
        local_dir: docs/api
        github_token: $GH_TOKEN
        provider: pages
        skip_cleanup: true
        keep_history: true
        on:
          branch: docs

    - language: node_js
      name: "Testing Server"
      nodejs:
          - "10"
      before_script: 
        - docker pull $DOCKER_USERNAME/express-mongo:travis
        - npm run build
      script:
        - npm run test
        - npm run test:coverage
        - npm run test:coveralls
        - npm run coverage:codacy
      